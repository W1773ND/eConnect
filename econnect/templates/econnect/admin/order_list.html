{% extends 'core/app_base_admin.html' %}
{% load i18n humanize staticfiles auth_tokens %}

{% block page_title %}
    <title> {% trans "Customer orders" %} - ikwen</title>
{% endblock %}

{% block head_style %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'echo/css/swiper.min.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'ikwen/ajaxuploader/css/fileuploader.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'embed-doc/css/embed-doc.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'econnect/css/base_default.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'econnect/css/admin.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'econnect/css/econnect_pricing.css' %}"/>
{% endblock %}

{% block breadcrumb_location %}
    <li>{% trans "Customer orders" %}</li>
{% endblock %}

{% block admin_content %}
    <div id="admin-content">
        <div class="container-fluid stage">
            <div id="admin-tools" class="ceil bottom-shade-xs">
                <form id="admin-tools-form" onsubmit="return false">
                    <div>
                        <div>
                            <i class="glyphicon glyphicon-search"></i>
                            <i class="glyphicon glyphicon-menu-left hide-search back"></i>
                            <input type="text" id="context-search" class="tool search form-input input-sm" placeholder="{% blocktrans %}Search {{ verbose_name }}{% endblocktrans %}"/>
                        </div>
                        {% if filter and filter|length > 0 %}
                            <div class="filter-trigger">
                                <i class="glyphicon glyphicon-filter"></i>
                                <i class="glyphicon glyphicon-menu-left hide-filter back"></i>
                                {% for elt in filter %}
                                <div class="tool filter">
                                    <label for="{{ elt.parameter_name }}" class="sr-only">{% trans elt.title %}</label>
                                    <select id="{{ elt.parameter_name }}" style="float: left; width: 120px" class="form-control input-sm {{ elt.parameter_name }} widget" name="{{ elt.parameter_name }}">
                                        <option value="">{% trans "All" %} {% trans elt.title %}</option>
                                        {% for choice in elt.choices %}
                                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </form>
                {% comment %}{% url change_object_url_name as change_object_url %}
                <a href="{{ change_object_url }}" class="btn btn-sm btn-success cta add pull-right action"
                        title="{% trans "Add new " %} {{ verbose_name }}">
                    <i class="glyphicon glyphicon-plus"></i>
                    <span class="hidden-xs">{% trans "Add" %}</span>
                </a>
                <div class="clearfix"></div>{% endcomment %}
            </div>
            <div id="results" class="col-lg-8 col-lg-offset-2">
                {% include 'core/snippets/spinner.html' %}
                {% include 'econnect/admin/snippets/order_list_results.html' %}
            </div>
        </div>
        <p class="text-muted text-center order-confirmed tpl">{% trans 'This order is waiting for payment...' %}</p>
    </div>
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{% static 'embed-doc/js/embed-doc.js' %}" ></script>
    <script type="text/javascript">
        (function () {
            $('.set-equipment').mouseover(function () {$(this).removeClass('animated')
            }).mouseout(function () {$(this).addClass('animated')
            }).click(function () {
                let orderId = $(this).parents('.event').attr('id');
                let params = {action: 'set_equipment', order_id: orderId};
                $.getJSON('', params, function (data) {
                    if (data.success) {
                        $('.set-equipment').removeClass('blink').text('{% trans "Sending request..." %}');
                        setTimeout(function () {location.reload()}, 2000)
                    }
                    else {
                        ikwen.showFloatingNotice('Error occurs when sending request, please try again...', '', 3);
                    }
                });
            });
            $('.order-accept').click(function () {
                let orderId = $(this).parents('.event').attr('id');
                let params = {action: 'accept_order', order_id: orderId};
                $.getJSON('', params, function (data) {
                    if (data.success) {
                        ikwen.showFloatingNotice('Order accepted', '', 3);
                        $('.order-accept').addClass('tpl');
                        $('.order-report').addClass('tpl');
                        $(this).parents('.event-action').append($('.order-confirmed').removeClass('tpl'));
                    }
                    else {
                        ikwen.showFloatingNotice('Error occurs when accepting this order, please try again...', '', 3);
                        setTimeout(function () {location.reload()}, 2000)
                    }
                });
            });
            $('.order-report').click(function () {
                let orderId = $(this).parents('.event').attr('id');
                let params = {action: 'report_order', order_id: orderId};
                $.getJSON('', params, function (data) {
                    if (data.success) {
                        ikwen.showFloatingNotice('Order reported', '', 2);
                    }
                    else {
                        ikwen.showFloatingNotice('Error occurs when reporting this order, please try again...', '', 3);
                    }
                });
                setTimeout(function () {location.reload()}, 2000)
            });
            $('.order-finish').click(function () {
                let orderId = $(this).parents('.event').attr('id');
                let params = {action: 'finish_order', order_id: orderId};
                $.getJSON('', params, function (data) {
                    if (data.success) {
                        ikwen.showFloatingNotice('Order classified', '', 2);
                    }
                    else {
                        ikwen.showFloatingNotice('Error occurs when classifying this order, please try again...', '', 3);
                    }
                });
                setTimeout(function () {location.reload()}, 2000)
            });
            $('.order-member-email').click(function () {
                {#To-DO: Set Email message to this member#}
            })
        })();
    </script>

{% endblock %}
